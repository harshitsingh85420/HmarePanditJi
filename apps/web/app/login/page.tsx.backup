"use client";

import React, { useEffect, Suspense } from "react";
import { useRouter } from "next/navigation";
import { useAuth } from "../../context/auth-context";
import { LoginForm } from "../../components/LoginForm";

function LoginContent() {
  const router = useRouter();
  const { user, loading } = useAuth();

  // Redirect if already logged in
  useEffect(() => {
    if (!loading && user) {
      if (user.role === "PANDIT") {
        const panditUrl = process.env.NEXT_PUBLIC_PANDIT_URL || "http://localhost:3002";
        const status = user.panditProfile?.verificationStatus;
        window.location.href =
          status === "PENDING"
            ? `${panditUrl}/onboarding`
            : `${panditUrl}/dashboard`;
      } else if (user.role === "ADMIN") {
        window.location.href =
          process.env.NEXT_PUBLIC_ADMIN_URL || "http://localhost:3003/";
      } else {
        router.replace("/");
      }
    }
  }, [user, loading, router]);

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="w-8 h-8 border-2 border-amber-500 border-t-transparent rounded-full animate-spin" />
      </div>
    );
  }

  return (
    <div className="min-h-screen flex">
      {/* â”€â”€ Left Panel: Branding (hidden on mobile) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
      <div className="hidden lg:flex flex-col justify-between w-[45%] bg-gradient-to-br from-[#f49d25] to-[#f09942] p-12 relative overflow-hidden">
        {/* Mandala decoration */}
        <div className="absolute inset-0 opacity-[0.06] bg-[url('/mandala-pattern.png')] bg-repeat bg-center" />

        <div className="relative z-10">
          {/* Logo */}
          <div className="flex items-center gap-3 mb-12">
            <span className="text-4xl">ğŸ™</span>
            <div>
              <div className="text-2xl font-black text-white tracking-tight">
                HmarePanditJi
              </div>
              <div className="text-white/80 text-sm font-medium">
                Sanskriti ko Digital Disha
              </div>
            </div>
          </div>

          {/* Trust badges */}
          <div className="space-y-4">
            {[
              {
                icon: "ğŸ”’",
                title: "Verified Pandits",
                desc: "Aadhaar & Video KYC certified",
              },
              {
                icon: "ğŸ’³",
                title: "Transparent Pricing",
                desc: "No hidden costs, ever",
              },
              {
                icon: "âœˆï¸",
                title: "Travel Managed",
                desc: "We handle all logistics",
              },
            ].map((badge) => (
              <div
                key={badge.title}
                className="flex items-center gap-4 bg-white/20 backdrop-blur-sm rounded-2xl px-5 py-4"
              >
                <span className="text-2xl flex-shrink-0">{badge.icon}</span>
                <div>
                  <div className="text-white font-bold text-sm">{badge.title}</div>
                  <div className="text-white/75 text-xs">{badge.desc}</div>
                </div>
              </div>
            ))}
          </div>
        </div>

        {/* Footer quote */}
        <div className="relative z-10 text-white/80 text-sm font-medium">
          500+ pandits &nbsp;Â·&nbsp; 4.8â˜… average &nbsp;Â·&nbsp; Delhi-NCR
        </div>
      </div>

      {/* â”€â”€ Right Panel: Login Form â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
      <div className="flex-1 flex items-center justify-center bg-[#f8f7f5] p-6 md:p-12">
        <div className="w-full max-w-md">
          {/* Mobile logo */}
          <div className="flex lg:hidden items-center gap-2 mb-8 justify-center">
            <span className="text-3xl">ğŸ™</span>
            <span className="text-xl font-black text-amber-600">HmarePanditJi</span>
          </div>

          {/* Form card */}
          <div className="bg-white rounded-3xl shadow-xl border border-gray-100 p-8 md:p-10">
            <LoginForm />
          </div>

          <p className="text-center text-xs text-gray-400 mt-6">
            By continuing, you agree to our{" "}
            <a href="/terms" className="underline hover:text-gray-600">
              Terms of Service
            </a>{" "}
            and{" "}
            <a href="/privacy" className="underline hover:text-gray-600">
              Privacy Policy
            </a>
            .
          </p>
        </div>
      </div>
    </div>
  );
}

export default function LoginPage() {
  return (
    <Suspense
      fallback={
        <div className="min-h-screen flex items-center justify-center">
          <div className="w-8 h-8 border-2 border-amber-500 border-t-transparent rounded-full animate-spin" />
        </div>
      }
    >
      <LoginContent />
    </Suspense>
  );
}
