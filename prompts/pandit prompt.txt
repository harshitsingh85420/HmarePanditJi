# HmarePanditJi â€“ Phase 1 Pandit App â€“ Complete Build Prompts

This is the single source of truth. Every prompt is selfâ€‘contained, follows the exact specifications from Bhagâ€¯12, and must be executed in order.  
**Stack**: Next.jsâ€¯14 PWA (`localhost:3002`) + REST API (`localhost:3001`)  
**Principles**: Voiceâ€‘first, Hindiâ€‘first, 44â€¯px+ tap targets, works on â‚¹8â€¯k Android phones.

---

## ğŸ“¦ Promptâ€¯1 â€“ Project Setup, Global Rules & Auth Integration

**Goal**  
Create the monorepo structure, install all dependencies, implement the shared voice hooks, authentication middleware, device info capture, and the unified login integration.

**Files to create/modify**  
- `apps/pandit/package.json` â€“ Next.jsâ€¯14 with PWA support (`next-pwa`)  
- `apps/pandit/app/layout.tsx` â€“ Root layout with Inter font, global CSS, PWA manifest  
- `apps/pandit/app/login/page.tsx` â€“ **No login page** (redirects to `localhost:3000/login`)  
- `apps/pandit/middleware.ts` â€“ Auth & onboarding redirect rules  
- `apps/pandit/hooks/useVoiceNarration.ts` â€“ SpeechSynthesis wrapper  
- `apps/pandit/hooks/useVoiceInput.ts` â€“ SpeechRecognition wrapper  
- `apps/pandit/hooks/useDeviceInfo.ts` â€“ Userâ€‘agent parser, posts to API  
- `apps/pandit/components/VoiceButton.tsx` â€“ Reusable orange pill ğŸ”Š with speech synthesis  
- `apps/pandit/types/onboarding.ts`, `types/booking.ts` â€“ Shared TypeScript types

**Detailed instructions**

1. **Project initialization**  
   - In the monorepo root, create `apps/pandit` using `create-next-app@latest` with TypeScript, Tailwind, App Router.  
   - Add `next-pwa` and configure `next.config.js` for PWA (manifest, service worker).  
   - Install additional deps: `axios`, `react-hook-form`, `zod`, `date-fns`, `lucide-react`, `framer-motion` (only for minimal animations).  
   - Ensure the app runs on portâ€¯3002 (set in `package.json` dev script: `next dev -p 3002`).

2. **Global layout (`app/layout.tsx`)**  
   - Import Inter from `next/font/google`.  
   - Set `lang="hi"` on `<html>`.  
   - Include a `<header>` with logo and `GuestBanner` (only shown if not logged in).  
   - Include a `<footer>` with contact links.  
   - Wrap the app with an `AuthProvider` (client component) that manages token and user state from localStorage.  
   - Add PWA meta tags and manifest link.

3. **Middleware (`middleware.ts`)**  
   - Define protected routes: `/dashboard/*`, `/onboarding/*`, `/bookings/*`, `/calendar/*`, `/earnings/*`, `/profile/*`.  
   - If no token â†’ redirect to `http://localhost:3000/login?redirect=pandit&next=${path}`.  
   - If token exists but `onboardingComplete === false` â†’ redirect to `/onboarding?step=<lastCompletedStep+1>` (read from token or fetch user).  
   - If token exists, onboarding complete, but `verificationStatus !== 'VERIFIED'` â†’ allow dashboard but show pending banner.  
   - If token exists and role is `ADMIN` â†’ redirect to `localhost:3003`.

4. **Voice hooks**  
   - **`useVoiceNarration.ts`** â€“ Returns `speak(text: string, lang='hi-IN')` and `stop()`. Use `window.speechSynthesis`.  
   - **`useVoiceInput.ts`** â€“ Returns `startListening(onResult: (transcript: string) => void)` and `stopListening()`. Use `webkitSpeechRecognition` or standard `SpeechRecognition`. Set language to `hi-IN`. Emits interim results, final result on `speechend`.  
   - Both hooks must gracefully degrade (if API unavailable, show a toast but not crash).

5. **Device info capture**  
   - In `useDeviceInfo.ts`, parse `navigator.userAgent` to extract `deviceModel` and `deviceOs` (use a lightweight parser like `ua-parser-js`).  
   - On every successful login (token received), call `POST /api/pandit/device-info` with the parsed info.  
   - Store this info in `PanditProfile`; it will be visible on the public profile later.

6. **Unified login integration (at `localhost:3000`)**  
   - The login page at `apps/web/app/login/page.tsx` must include a role toggle (Customer / Pandit Ji).  
   - When â€œPandit Jiâ€ is selected, the OTP flow should call `/api/auth/send-otp` and `/api/auth/verify-otp` with `role='PANDIT'`.  
   - After OTP verification, the backend returns a JWT. Save it to localStorage with key `hpj_pandit_token`.  
   - Then redirect to `localhost:3002/dashboard` (or the `next` param).  
   - In the Pandit app, the `AuthProvider` reads the token from localStorage and attaches it to all API requests via `Authorization` header.

7. **Voice button component**  
   - `VoiceButton.tsx` â€“ An orange pill with ğŸ”Š icon and text â€œà¤¸à¥à¤¨à¥‡à¤‚â€.  
   - Accepts a `text` prop; on click, calls `speak(text)`. While speaking, icon changes to â¹ï¸ and text to â€œà¤¬à¤‚à¤¦ à¤•à¤°à¥‡à¤‚â€.  
   - Clicking stop cancels speech.  
   - Place this button in the topâ€‘right corner of every onboarding step and on key dashboard pages.

8. **Global CSS / design tokens**  
   - Primary amber: `#F09942`.  
   - Danger red: `#EF4444`.  
   - Success green: `#10B981`.  
   - Info blue: `#3B82F6`.  
   - Borderâ€‘radius: `12px` for cards, `8px` for buttons, `24px` for pills.  
   - All interactive elements must have `min-height: 44px` and `min-width: 44px`.

**Testing**  
- Run the app on a lowâ€‘end Android device (or Chrome device emulation) to verify touch targets.  
- Ensure that without a token, navigation to `/dashboard` redirects to the login page on portâ€¯3000.  
- After login, token is stored and device info is posted.

---

## ğŸ“¦ Promptâ€¯2 â€“ Onboarding Wizard Shell & Stepâ€¯1 (Basic Info)

**Goal**  
Build the 6â€‘step wizard container, progress bar, and implement Stepâ€¯1: personal details, profile photo, audio bio recording, Aadhaar/PAN.

**Files to create/modify**  
- `apps/pandit/app/onboarding/page.tsx` â€“ Shell that reads `?step` and renders the appropriate step component  
- `apps/pandit/app/onboarding/layout.tsx` â€“ Minimal layout (no sidebar, just the wizard)  
- `apps/pandit/app/onboarding/components/StepProgress.tsx` â€“ 6â€‘step progress bar with labels  
- `apps/pandit/app/onboarding/components/Step1.tsx` â€“ All fields from sectionâ€¯C  
- `apps/pandit/app/onboarding/components/AudioBioRecorder.tsx` â€“ 3â€‘state recorder (before, recording, review)  
- `apps/pandit/hooks/useOnboarding.ts` â€“ Zustand (or context) to persist step data in localStorage  
- `apps/pandit/components/FormFieldWithVoice.tsx` â€“ Wrapper for inputs with mic button

**Detailed instructions**

1. **Onboarding shell (`page.tsx`)**  
   - Use search params to get `step`. If missing, default to `1`.  
   - If step > last completed step (from `useOnboarding` state) and user is not yet verified, redirect to the last incomplete step.  
   - Render `<StepProgress currentStep={step} />` at the top.  
   - Conditionally render `<Step1 />`, `<Step2 />`, etc. based on `step`.  
   - Provide â€œSave & Continueâ€ and â€œBackâ€ buttons (except on stepâ€¯1). On save, call API for that step, then update local state and advance.

2. **Step progress component**  
   - Display 6 circles connected by lines.  
   - Labels (Hindi): 1=à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€, 2=à¤ªà¥‚à¤œà¤¾, 3=à¤¯à¤¾à¤¤à¥à¤°à¤¾, 4=à¤¸à¤¾à¤®à¤—à¥à¤°à¥€, 5=KYC, 6=à¤¬à¥ˆà¤‚à¤•.  
   - Completed steps: green filled with âœ“. Current step: amber pulsing circle. Future steps: gray empty.  
   - On mobile, show only the current step label.

3. **Stepâ€¯1 form (`Step1.tsx`)**  
   - All fields from sectionâ€¯C3c:  
     * Full name (text, required, min 3 chars, mic)  
     * Date of birth (date picker, max todayâ€‘18, shows age after selection)  
     * Gender (3 large pill radios: à¤ªà¥à¤°à¥à¤· / à¤®à¤¹à¤¿à¤²à¤¾ / à¤…à¤¨à¥à¤¯)  
     * Home city (searchable dropdown from `SUPPORTED_CITIES`, mic)  
     * Home state (autoâ€‘filled when city selected, editable)  
     * Experience years (number input with â€œà¤µà¤°à¥à¤·â€ suffix)  
     * Bio (textarea, 50â€‘300 chars, character counter, mic)  
     * Aadhaar number (12â€‘digit masked, regex, stored encrypted)  
     * PAN number (uppercase, regex, optional)  
   - Each text field uses `<FormFieldWithVoice>` which adds a mic icon that triggers speech recognition and fills the field.  
   - Profile photo upload (large circular avatar with camera overlay).  
     * On click: file picker â†’ upload to `/api/upload/profile-photo`. Show spinner, on success update photo URL.  
   - Audio bio recorder (sectionâ€¯C3b) â€“ use `<AudioBioRecorder />`.

4. **AudioBioRecorder component**  
   - **State A (before)**: Amber card with microphone icon, heading â€œà¤…à¤ªà¤¨à¤¾ à¤‘à¤¡à¤¿à¤¯à¥‹ à¤ªà¤°à¤¿à¤šà¤¯ à¤°à¤¿à¤•à¥‰à¤°à¥à¤¡ à¤•à¤°à¥‡à¤‚â€, subtext, example prompt box, large red ğŸ™ï¸ â€œà¤°à¤¿à¤•à¥‰à¤°à¥à¤¡ à¤•à¤°à¥‡à¤‚â€ button.  
   - **State B (recording)**: Pulsing red border, timer counting up to 2â€¯min (autoâ€‘stop), stop button. Use `MediaRecorder` API.  
   - **State C (review)**: `<audio controls>` with recorded blob, green â€œâœ… à¤¯à¤¹ à¤ à¥€à¤• à¤¹à¥ˆ â€” Upload à¤•à¤°à¥‡à¤‚â€, amber outline â€œğŸ”„ à¤¦à¥‹à¤¬à¤¾à¤°à¤¾ à¤°à¤¿à¤•à¥‰à¤°à¥à¤¡ à¤•à¤°à¥‡à¤‚â€.  
   - On upload: `POST /api/upload/audio-bio`. On success, store URL in state.  
   - Allow skip: â€œà¤¬à¤¾à¤¦ à¤®à¥‡à¤‚ à¤­à¥€ à¤œà¥‹à¤¡à¤¼ à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚â€ link (optional).

5. **Form persistence**  
   - In `useOnboarding.ts`, use Zustand with persist middleware (or React context + localStorage) to store all step data.  
   - On each field change, update the store.  
   - On â€œSave & Continueâ€, validate required fields, then call `POST /api/pandit/onboarding/step1` with the collected data.  
   - After successful API response, mark stepâ€¯1 as completed and navigate to `?step=2`.

6. **Backend API â€“ Stepâ€¯1**  
   - `POST /api/pandit/onboarding/step1`  
   - Expects all fields, encrypts Aadhaar before storing, saves to `User` and `PanditProfile`.  
   - Returns `{ success: true, step: 1 }`.

**Testing**  
- Try the flow on a mobile device: mic should work.  
- After filling, refresh the page â€“ data should persist.  
- Upload a photo and audio; ensure they are sent to the API.

---

## ğŸ“¦ Promptâ€¯3 â€“ Onboarding Stepâ€¯2 (Puja Specializations)

**Goal**  
Implement Stepâ€¯2: puja type selection, languages, vedic degree, gotra, certifications, and perâ€‘puja dakshina/duration.

**Files to create/modify**  
- `apps/pandit/app/onboarding/components/Step2.tsx`  
- `apps/pandit/components/PujaTypeGrid.tsx` â€“ reâ€‘usable pill grid  
- `apps/pandit/components/LanguageGrid.tsx` â€“ reâ€‘usable pill grid for languages  
- `apps/pandit/components/DakshinaRow.tsx` â€“ inline editor for perâ€‘puja pricing

**Detailed instructions**

1. **Voice narration**  
   - Place `VoiceButton` with the Hindi text from sectionâ€¯D1.

2. **Puja types grid**  
   - Use the list from sectionâ€¯D2. Each item: emoji + Hindi name.  
   - Pill cards: selected = amber fill + white text, unselected = gray border + dark text.  
   - Must select at least 1.  
   - Voice input: when user clicks mic, listen for a phrase like â€œà¤µà¤¿à¤µà¤¾à¤¹â€ and autoâ€‘select the matching pill (fuzzy match using a simple string similarity).

3. **Languages grid**  
   - Use list from sectionâ€¯D3. Hindi preâ€‘selected and cannot be deselected if it is the only selection.  
   - Multiâ€‘select, minimum 1.

4. **Vedic degree dropdown**  
   - Options from sectionâ€¯D4. Default â€œà¤•à¥‹à¤ˆ à¤¨à¤¹à¥€à¤‚â€.

5. **Gotra input**  
   - Text field with mic. Optional.

6. **Certifications**  
   - Tagâ€‘input component: user types a certificate name and presses Enter to add as a tag. Max 5.  
   - Display existing tags with remove (Ã—) button.  
   - Examples shown as hints below.

7. **Perâ€‘puja dakshina & duration**  
   - After puja types are selected, a subâ€‘section appears below the grid: â€œà¤ªà¥à¤°à¤¤à¥à¤¯à¥‡à¤• à¤ªà¥‚à¤œà¤¾ à¤•à¥‡ à¤²à¤¿à¤ à¤¦à¤•à¥à¤·à¤¿à¤£à¤¾ à¤”à¤° à¤¸à¤®à¤¯â€.  
   - For each selected puja, render a compact row with:  
     * Puja name (readâ€‘only amber label)  
     * Dakshina (â‚¹ number input, min â‚¹500, required, mic)  
     * Duration (decimal hours, min 0.5, max 12, required)  
     * Description (short textarea, optional, mic)  
   - Use `DakshinaRow` component.

8. **Validation & persistence**  
   - Store all selections in Zustand store.  
   - On â€œSave & Continueâ€, validate at least one puja selected, all dakshina fields filled.  
   - Call `POST /api/pandit/onboarding/step2` with the data.  
   - On success, mark stepâ€¯2 completed, go to `?step=3`.

9. **Backend API â€“ Stepâ€¯2**  
   - `POST /api/pandit/onboarding/step2`  
   - Expects `{ pujaTypes, languages, vedicDegree, gotra, certifications, dakshinas: [{pujaType, amount, durationHours, description}] }`  
   - Deletes old `PanditSpecialization` and `PujaService` records, inserts new ones.  
   - Updates `PanditProfile` with languages, vedicDegree, gotra, certifications.  
   - Returns `{ success: true, step: 2 }`.

**Testing**  
- Ensure that selecting/deselecting puja types correctly shows/hides the dakshina rows.  
- Try voice input for puja names.  
- Verify that after refresh, selected pujas and entered dakshina are restored.

---

## ğŸ“¦ Promptâ€¯4 â€“ Onboarding Stepâ€¯3 (Travel Preferences)

**Goal**  
Implement Stepâ€¯3: main travel toggle, perâ€‘mode distance sliders, selfâ€‘drive options, hotel preference, advance notice.

**Files to create/modify**  
- `apps/pandit/app/onboarding/components/Step3.tsx`  
- `apps/pandit/components/TravelModeCard.tsx` â€“ card with mode icon, toggle, and distance slider  
- `apps/pandit/components/SliderWithPresets.tsx` â€“ slider with preset buttons

**Detailed instructions**

1. **Voice narration** â€“ use `VoiceButton` with text from sectionâ€¯E1.

2. **Main travel toggle**  
   - Large switch with â€œà¤•à¥à¤¯à¤¾ à¤†à¤ª à¤¦à¥‚à¤° à¤•à¥‡ à¤¬à¥à¤•à¤¿à¤‚à¤— à¤•à¥‡ à¤²à¤¿à¤ à¤¯à¤¾à¤¤à¥à¤°à¤¾ à¤•à¤°à¥‡à¤‚à¤—à¥‡?â€ â€“ YES / NO. Default YES.  
   - If NO, hide all travelâ€‘related fields, set `maxTravelDistanceKm = 0`, and ensure only local bookings are sent.

3. **Travel mode cards**  
   - For each mode (selfâ€‘drive, cab, bus, train, flight), render a `TravelModeCard`.  
   - Each card contains:  
     * Mode icon + name (Hindi + English)  
     * Toggle to enable/disable the mode  
     * When enabled, show a distance slider (single value or range per spec).  
   - Distance ranges:  
     * Selfâ€‘drive: 0â€“200â€¯km, presets 25,â€¯50,â€¯100â€¯km  
     * Cab: 50â€“500â€¯km, presets 100,â€¯200,â€¯300â€¯km  
     * Bus: 100â€“800â€¯km, presets 200,â€¯400,â€¯600â€¯km  
     * Train: 200â€“2000â€¯km, presets 500,â€¯1000,â€¯1500â€¯km  
     * Flight: toggle only (any distance)  
   - Use `SliderWithPresets` component.

4. **Selfâ€‘drive additional fields** (only if selfâ€‘drive enabled)  
   - Vehicle type: pill buttons â€“ Car / Bike / à¤¦à¥‹à¤¨à¥‹à¤‚  
   - Rate per km: number input with â‚¹ prefix, default â‚¹12, min â‚¹8, max â‚¹25.  
   - Note: â€œà¤¯à¤¹ rate à¤†à¤ªà¤•à¥‹ reimburse à¤¹à¥‹à¤—à¤¾ â€” à¤¯à¤¾à¤¤à¥à¤°à¤¾ à¤²à¤¾à¤—à¤¤ à¤•à¤¾ calculation à¤‡à¤¸à¥€ à¤¸à¥‡ à¤¹à¥‹à¤—à¤¾â€

5. **Hotel preference** (shown when any mode beyond selfâ€‘drive is enabled)  
   - Pill buttons singleâ€‘select: à¤¬à¤œà¤Ÿ à¤¹à¥‹à¤Ÿà¤² / 3â€‘à¤¸à¥à¤Ÿà¤¾à¤° / 4â€‘à¤¸à¥à¤Ÿà¤¾à¤° / à¤•à¥‹à¤ˆ à¤­à¥€ à¤šà¤²à¥‡à¤—à¤¾

6. **Advance notice**  
   - Segmented control: 1â€¯à¤¦à¤¿à¤¨ / 2â€¯à¤¦à¤¿à¤¨ / 3â€¯à¤¦à¤¿à¤¨ / 7â€¯à¤¦à¤¿à¤¨ / à¤•à¥‹à¤ˆ à¤­à¥€  
   - This sets `advanceNoticeDays` (integer). Bookings requiring shorter notice will not be offered.

7. **Food allowance policy info card** (readâ€‘only)  
   - Green card with platform policy: â‚¹1000/day for travel days + puja days if customer doesnâ€™t provide meals.  
   - No editable fields, just information.

8. **Validation & persistence**  
   - Store all preferences in Zustand.  
   - On â€œSave & Continueâ€, if main toggle is YES, ensure at least one mode enabled.  
   - Call `POST /api/pandit/onboarding/step3` with the travel preferences JSON.  
   - On success, go to `?step=4`.

9. **Backend API â€“ Stepâ€¯3**  
   - `POST /api/pandit/onboarding/step3`  
   - Body: `{ willingToTravel, travelModes: [{ mode, enabled, maxDistanceKm }], vehicleType, ratePerKm, hotelPreference, advanceNoticeDays }`  
   - Updates `PanditProfile.travelPreferences` as JSON.  
   - Returns `{ success: true, step: 3 }`.

**Testing**  
- Toggle selfâ€‘drive on/off â€“ the vehicle fields should appear/disappear.  
- Change slider values â€“ they should update the store.  
- Verify that food allowance card is always visible and matches spec.

---

## ğŸ“¦ Promptâ€¯5 â€“ Onboarding Stepâ€¯4 (Samagri Packages)

**Goal**  
Implement Stepâ€¯4: dualâ€‘model samagri package creation with three tiers, item entry, and live preview.

**Files to create/modify**  
- `apps/pandit/app/onboarding/components/Step4.tsx`  
- `apps/pandit/components/SamagriPackageCard.tsx` â€“ perâ€‘tier card with toggle, price, item list  
- `apps/pandit/components/LivePreviewCard.tsx` â€“ shows how package looks to customer  
- `apps/pandit/components/VoiceItemEntry.tsx` â€“ voiceâ€‘driven item tag input

**Detailed instructions**

1. **Voice narration** â€“ use `VoiceButton` with text from sectionâ€¯F2.

2. **Puja type selector**  
   - If multiple puja types were selected in Stepâ€¯2, show horizontal tabs; the pandit configures packages per puja separately.  
   - Default tab = first puja type.

3. **Default vs custom list choice**  
   - Two radio options: â€œà¤ªà¤¹à¤²à¥‡ à¤¸à¥‡ à¤¬à¤¨à¥€ list à¤‡à¤¸à¥à¤¤à¥‡à¤®à¤¾à¤² à¤•à¤°à¥‡à¤‚â€ (platform preâ€‘populated list) and â€œà¤¨à¤ˆ list à¤–à¥à¤¦ à¤¬à¤¨à¤¾à¤à¤‚â€.  
   - If platform list chosen, show a default item set for that puja (hardâ€‘coded in frontend, e.g., for Vivah: â€œà¤•à¥à¤®à¤•à¥à¤®, à¤šà¤¾à¤µà¤², à¤…à¤—à¤°à¤¬à¤¤à¥à¤¤à¥€, à¤˜à¥€, à¤¦à¥€à¤ªà¤•, à¤«à¥‚à¤²â€).  
   - Pandit can edit quantities/qualities.

4. **Package cards**  
   - Three cards for Basic, Standard, Premium (order fixed).  
   - Each card has a toggle to enable/disable. Disabled card = grayed out, fields nonâ€‘editable.  
   - Fields:  
     * Package name (text, placeholder â€œà¤¸à¤¾à¤§à¤¾à¤°à¤£ à¤ªà¥‚à¤œà¤¾ à¤¸à¤¾à¤®à¤—à¥à¤°à¥€â€, max 40â€¯chars)  
     * Price (â‚¹ number, min â‚¹100, required if enabled)  
     * Description (textarea, 50â€‘200â€¯chars)  
     * Item list (tagâ€‘input with voice support)  
         - On ğŸ™ï¸, use voice input to speak items in sequence: â€œGhee ek kilo, Kumkum ek packetâ€.  
         - Parse spoken items and add as tags.  
     * For each item, user can optionally type quantity (e.g., â€œ1â€¯kgâ€) and quality note (e.g., â€œShuddh Desi Gheeâ€).  
   - At least one package must be enabled to proceed.

5. **Live preview card**  
   - Right side (desktop) / below (mobile) shows a preview of the currently selected puja + tier.  
   - Displays package name, price in large, item list, description. Updates live as pandit edits.  
   - Title: â€œà¤—à¥à¤°à¤¾à¤¹à¤• à¤•à¥‹ à¤à¤¸à¤¾ à¤¦à¤¿à¤–à¥‡à¤—à¤¾â€.

6. **Voiceâ€‘driven item entry**  
   - `VoiceItemEntry` component: when mic clicked, start listening. Pandit speaks items separated by pauses or commas.  
   - Recognized items are shown as tags with quantity input alongside.  
   - If item not in master database, still add as custom item.

7. **Validation & persistence**  
   - Store packages in Zustand.  
   - On â€œSave & Continueâ€, validate that at least one package is enabled and all required fields are filled.  
   - Call `POST /api/pandit/onboarding/step4` with the packages data.  
   - On success, go to `?step=5`.

8. **Backend API â€“ Stepâ€¯4**  
   - `POST /api/pandit/onboarding/step4`  
   - Body: `{ canBringSamagri: true, packages: [{ pujaType, tier, name, price, description, items: [{name, quantity, qualityNote}] }] }`  
   - Deletes old packages, inserts new ones.  
   - Returns `{ success: true, step: 4 }`.

**Testing**  
- Switch between puja tabs â€“ packages should be separate.  
- Enable a package, fill items, see live preview update.  
- Use voice to add items â€“ should work on Chrome Android.

---

## ğŸ“¦ Promptâ€¯6 â€“ Onboarding Stepâ€¯5 (Video KYC & Documents)

**Goal**  
Implement Stepâ€¯5: upload of Aadhaar front/back, selfie with Aadhaar, and inâ€‘browser video KYC recording.

**Files to create/modify**  
- `apps/pandit/app/onboarding/components/Step5.tsx`  
- `apps/pandit/components/UploadZone.tsx` â€“ dashedâ€‘border upload area with progress  
- `apps/pandit/components/KYCVideoCapture.tsx` â€“ 3â€‘state video recorder

**Detailed instructions**

1. **Voice narration** â€“ use `VoiceButton` with text from sectionâ€¯G1.

2. **Document upload zones**  
   - Three zones vertically on mobile, horizontally on desktop:  
     * à¤†à¤§à¤¾à¤° à¤•à¤¾à¤°à¥à¤¡ â€” à¤¸à¤¾à¤®à¤¨à¥‡ (Aadhaar Front)  
     * à¤†à¤§à¤¾à¤° à¤•à¤¾à¤°à¥à¤¡ â€” à¤ªà¥€à¤›à¥‡ (Aadhaar Back)  
     * à¤†à¤§à¤¾à¤° à¤•à¥‡ à¤¸à¤¾à¤¥ à¤¸à¥‡à¤²à¥à¤«à¥€ (Selfie with Aadhaar)  
   - Each zone: dashed border, 120â€¯px tall, camera icon, caption.  
   - On click/tap: open file picker (accept images and PDF for front/back; images only for selfie).  
   - On file select: upload to `/api/upload/kyc-document?type=...`, show progress bar inside zone.  
   - On success: replace dashed border with solid green border + thumbnail of uploaded image.

3. **Video KYC recording**  
   - Component `KYCVideoCapture.tsx` with three states:  
     * **Instructions**: Amber card with bullet points of what to say, large ğŸ¥ â€œVideo Record à¤•à¤°à¥‡à¤‚â€ button.  
     * **Recording**: Camera feed (via `getUserMedia`), 30â€‘second countdown timer (autoâ€‘stop), stop button.  
       - Record using `MediaRecorder`, collect chunks.  
     * **Review**: `<video>` element with playback, green â€œâœ… à¤¯à¤¹ à¤ à¥€à¤• à¤¹à¥ˆ â€” Upload à¤•à¤°à¥‡à¤‚â€, amber â€œğŸ”„ à¤«à¤¿à¤° à¤¸à¥‡ Record à¤•à¤°à¥‡à¤‚â€.  
   - On upload: `POST /api/upload/kyc-video` (multipart, max 50â€¯MB).  
   - On success: show green â€œâœ… Video upload à¤¹à¥‹ à¤—à¤ˆâ€.

4. **Completion status**  
   - After all 4 uploads are successful, show a green card:  
     * â€œâœ… à¤¸à¤­à¥€ à¤¦à¤¸à¥à¤¤à¤¾à¤µà¥‡à¤œà¤¼ à¤œà¤®à¤¾ à¤¹à¥‹ à¤—à¤!â€  
     * â€œà¤¹à¤®à¤¾à¤°à¥€ team 24â€‘48 à¤˜à¤‚à¤Ÿà¥‹à¤‚ à¤®à¥‡à¤‚ verify à¤•à¤°à¥‡à¤—à¥€à¥¤â€  
     * â€œVerification à¤•à¥‡ à¤¬à¤¾à¤¦ à¤†à¤ªà¤•à¥‹ SMS à¤†à¤à¤—à¤¾à¥¤â€  
   - The â€œSave & Continueâ€ button is disabled until all uploads are done.

5. **Validation & persistence**  
   - Store uploaded URLs in Zustand.  
   - On â€œSave & Continueâ€, call `POST /api/pandit/onboarding/step5` with all four URLs.  
   - On success, go to `?step=6`.

6. **Backend API â€“ Stepâ€¯5**  
   - `POST /api/pandit/onboarding/step5`  
   - Body: `{ aadhaarFrontUrl, aadhaarBackUrl, aadhaarSelfieUrl, kycVideoUrl }`  
   - Creates a `KYCSubmission` record, updates `PanditProfile.verificationStatus = 'DOCUMENTS_SUBMITTED'`.  
   - Returns `{ success: true, step: 5 }`.

**Testing**  
- Test upload with large images (should show progress).  
- Test video recording, ensure 30â€‘second limit works.  
- After all uploads, the button should become enabled.

---

## ğŸ“¦ Promptâ€¯7 â€“ Onboarding Stepâ€¯6 (Bank Details & Submission)

**Goal**  
Implement Stepâ€¯6: bank account form, IFSC explanation modal, submission, and celebration page.

**Files to create/modify**  
- `apps/pandit/app/onboarding/components/Step6.tsx`  
- `apps/pandit/app/onboarding/complete/page.tsx` â€“ celebration page  
- `apps/pandit/components/IFSCModal.tsx` â€“ modal explaining IFSC

**Detailed instructions**

1. **Voice narration** â€“ use `VoiceButton` with text from sectionâ€¯H1.

2. **Warning card**  
   - Red/yellow card with âš ï¸ icon and text: â€œà¤¸à¤¿à¤°à¥à¤« à¤…à¤ªà¤¨à¥€ à¤–à¥à¤¦ à¤•à¥€ bank account à¤•à¥€ à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€ à¤­à¤°à¥‡à¤‚à¥¤â€

3. **Bank form fields** (all required except UPI)  
   - à¤–à¤¾à¤¤à¤¾à¤§à¤¾à¤°à¤• à¤•à¤¾ à¤¨à¤¾à¤® (text, required)  
   - à¤¬à¥ˆà¤‚à¤• à¤•à¤¾ à¤¨à¤¾à¤® (searchable dropdown with common banks, required)  
   - à¤–à¤¾à¤¤à¤¾ à¤¨à¤‚à¤¬à¤° (number input, 9â€‘18 digits, required)  
   - à¤–à¤¾à¤¤à¤¾ à¤¨à¤‚à¤¬à¤° à¤¦à¥‹à¤¬à¤¾à¤°à¤¾ (must match exactly, validation shown inline)  
   - IFSC à¤•à¥‹à¤¡ (text, uppercase, regex, required) with [?] button next to it  
   - à¤–à¤¾à¤¤à¤¾ à¤ªà¥à¤°à¤•à¤¾à¤° (pill toggle: à¤¬à¤šà¤¤ à¤–à¤¾à¤¤à¤¾ / à¤šà¤¾à¤²à¥‚ à¤–à¤¾à¤¤à¤¾, default Savings)  
   - UPI ID (optional, regex `^[a-zA-Z0-9._-]+@[a-zA-Z]+$`)

4. **IFSC explanation modal**  
   - Opens when [?] clicked.  
   - Content: â€œIFSC code à¤•à¥à¤¯à¤¾ à¤¹à¥‹à¤¤à¤¾ à¤¹à¥ˆ? â€¦â€ with example.  
   - Saffron header, close button.  
   - Use a simple dialog component.

5. **Submit button**  
   - Large amber button: â€œğŸ‰ à¤ªà¥à¤°à¥‹à¤«à¤¾à¤‡à¤² à¤ªà¥‚à¤°à¥€ à¤•à¤°à¥‡à¤‚â€.  
   - On click: validate all fields (including account number match).  
   - Call `POST /api/pandit/onboarding/complete` with all data.  
   - On success, redirect to `/onboarding/complete`.

6. **Celebration page**  
   - Route: `/onboarding/complete` (no sidebar).  
   - Pure CSS confetti animation (no library).  
   - â€œğŸ™ à¤¬à¤§à¤¾à¤ˆ à¤¹à¥‹, [Name]!â€ heading.  
   - Timeline of next steps (as shown in sectionâ€¯H6).  
   - Button: â€œà¤¡à¥ˆà¤¶à¤¬à¥‹à¤°à¥à¤¡ à¤ªà¤° à¤œà¤¾à¤à¤‚ â†’â€ that goes to `/dashboard`.

7. **Backend API â€“ complete**  
   - `POST /api/pandit/onboarding/complete`  
   - Body: `{ accountHolderName, bankName, accountNumber, confirmAccountNumber, ifscCode, accountType, upiId }`  
   - Validates account number match, encrypts account number.  
   - Creates `BankAccount` record.  
   - Sets `PanditProfile.onboardingComplete = true`, `profileCompletionPercent = 80`, `completedSteps = [1,2,3,4,5,6]`.  
   - Sends a mock SMS (console log).  
   - Returns `{ success: true, redirectTo: "/dashboard" }`.

**Testing**  
- Try mismatched account numbers â€“ error shown.  
- Click [?] â€“ modal opens.  
- After submission, ensure you land on celebration page with confetti.

---

## ğŸ“¦ Promptâ€¯8 â€“ Interactive Tutorial System

**Goal**  
After onboarding, automatically start a 5â€‘screen interactive tutorial overlay. Allow replay via ? icon.

**Files to create/modify**  
- `apps/pandit/components/TutorialOverlay.tsx` â€“ fullâ€‘screen overlay with 5 screens  
- `apps/pandit/hooks/useTutorial.ts` â€“ manages whether tutorial has been shown (localStorage flag)

**Detailed instructions**

1. **Trigger**  
   - After the first time user visits `/dashboard` (and `onboardingComplete` is true), check a localStorage key `hpj_tutorial_seen`.  
   - If not seen, automatically show the tutorial overlay (after a short delay).  
   - The overlay is a fullâ€‘screen dark semiâ€‘transparent backdrop with a centered content card.

2. **Tutorial overlay**  
   - Contains:  
     * A â€œSkip Tutorialâ€ link at topâ€‘right.  
     * Content area showing current screen (title + description + highlight area).  
     * Navigation: Previous (if >1) and Next (if <5) buttons.  
     * Step dots at bottom (5 dots, amber filled for current).  
   - On each screen, use a â€œspotlightâ€ effect (simple CSS boxâ€‘shadow) to highlight the UI element being explained (e.g., online/offline toggle).  
   - The actual UI behind is visible but semiâ€‘transparent; the spotlight illuminates the target element.

3. **5 screens content** (from sectionâ€¯I3)  
   - **Screenâ€¯1**: Online/Offline toggle (highlight the toggle in header).  
   - **Screenâ€¯2**: New booking alert (highlight the amber alert card area).  
   - **Screenâ€¯3**: Booking detail & earnings breakdown (highlight the earnings card).  
   - **Screenâ€¯4**: â€œI'm Hereâ€ buttons (highlight the sequential buttons).  
   - **Screenâ€¯5**: Earnings & Calendar (highlight sidebar links).  
   - Each screen has a title and descriptive text in Hindi (as per spec).  
   - Voice narration plays automatically when screen appears (use `useVoiceNarration`).

4. **Replay**  
   - In the header, next to the avatar, add a â€œ?â€ icon.  
   - Clicking it opens the tutorial overlay again (even if already seen).  
   - Do not reset the `seen` flag.

**Testing**  
- On first dashboard visit, tutorial should start automatically.  
- Click â€œSkipâ€ â€“ overlay closes, `seen` flag set.  
- Click â€œ?â€ â€“ tutorial reopens.

---

## ğŸ“¦ Promptâ€¯9 â€“ Home Dashboard

**Goal**  
Implement the main dashboard with pending verification banner, pending requests alert (with 6â€‘hour timer), todayâ€™s schedule, earnings widget, stats, and polling for new requests.

**Files to create/modify**  
- `apps/pandit/app/dashboard/page.tsx`  
- `apps/pandit/app/dashboard/layout.tsx` â€“ sidebar and header (shared)  
- `apps/pandit/components/SidebarNav.tsx`  
- `apps/pandit/components/TopHeader.tsx` (with online/offline toggle, notification bell, avatar)  
- `apps/pandit/components/NewBookingAlert.tsx` â€“ pulsing amber card with countdown  
- `apps/pandit/hooks/useBookingPolling.ts` â€“ polls for new requests every 30â€¯s

**Detailed instructions**

1. **Layout**  
   - Desktop: fixed left sidebar (240â€¯px, dark brown), main content scrollable.  
   - Mobile: bottom tab bar (5 icons + labels), no sidebar.  
   - Sidebar items: ğŸ  à¤¡à¥ˆà¤¶à¤¬à¥‹à¤°à¥à¤¡, ğŸ“‹ à¤¬à¥à¤•à¤¿à¤‚à¤—, ğŸ“… à¤•à¥ˆà¤²à¥‡à¤‚à¤¡à¤°, ğŸ’° à¤•à¤®à¤¾à¤ˆ, ğŸ‘¤ à¤ªà¥à¤°à¥‹à¤«à¤¾à¤‡à¤².  
   - Sidebar footer: pandit avatar + name + verification badge pill, â€œà¤µà¥‡à¤°à¥€à¤«à¤¿à¤•à¥‡à¤¶à¤¨: â€¦â€, ğŸ“ à¤¸à¤¹à¤¾à¤¯à¤¤à¤¾.

2. **Top header**  
   - Left: logo + â€œPandit Portalâ€.  
   - Right:  
     * Online/offline pill toggle (green when online, red when offline). Click calls `PATCH /api/pandit/online-status`.  
     * Notification bell with red dot badge (unread count).  
     * Avatar dropdown with Profile, Settings, Logout.

3. **Pending verification banner** (if verificationStatus â‰  VERIFIED)  
   - Amber background, â³ icon, message, and [à¤¦à¤¸à¥à¤¤à¤¾à¤µà¥‡à¤œà¤¼ à¤¦à¥‡à¤–à¥‡à¤‚] link to `/profile#documents`.

4. **Data fetching**  
   - On mount, call `GET /api/pandit/dashboard-summary` (response shape in sectionâ€¯J4).  
   - Store in state.

5. **Section A â€“ Urgent Alert Zone**  
   - Only render if `pendingRequests.length > 0`.  
   - For each request (max 2, then â€œà¤”à¤° à¤¦à¥‡à¤–à¥‡à¤‚â€):  
     * Card with amber left border, event type, date, location, customer name+rating, estimated earning.  
     * Live countdown timer (from `createdAt + 6h - now`), updates every second.  
       â€“ When < 1â€¯h, timer text turns red.  
       â€“ When â‰¤ 0, card shows â€œâ° Expiredâ€ and is removed.  
     * Two buttons: [âœ… à¤¸à¥à¤µà¥€à¤•à¤¾à¤° à¤•à¤°à¥‡à¤‚] [âŒ à¤…à¤¸à¥à¤µà¥€à¤•à¤¾à¤° à¤•à¤°à¥‡à¤‚] â†’ both navigate to `/bookings/{id}`.

6. **Section B â€“ Todayâ€™s Schedule Card**  
   - If `todaysBooking` exists: show event, time, venue, customer name (if confirmed), and buttons [Navigate] (opens maps) and [Call Customer] (only if status >= PANDIT_ARRIVED).  
   - If none: show â€œà¤†à¤œ à¤•à¥‹à¤ˆ booking à¤¨à¤¹à¥€à¤‚ à¤¹à¥ˆà¥¤â€ with illustration.

7. **Section C â€“ Earnings Widget**  
   - Gradient card with â€œà¤‡à¤¸ à¤®à¤¹à¥€à¤¨à¥‡ à¤•à¥€ à¤•à¤®à¤¾à¤ˆâ€ and large amount, number of bookings, [à¤µà¤¿à¤¸à¥à¤¤à¤¾à¤° à¤¦à¥‡à¤–à¥‡à¤‚] link.

8. **Section D â€“ Quick Stats Row**  
   - 4 stat boxes: Rating, Completed, This Month, Reviews. Values from `stats`.

9. **Section E â€“ Upcoming Bookings**  
   - List of next 5 bookings with date, event, city, status badge, and [Details] link.

10. **Polling for new requests**  
    - `useBookingPolling.ts` â€“ uses `setInterval` to call `GET /api/pandit/pending-requests` every 30â€¯s.  
    - If new count > previous count:  
      * Play `/sounds/booking-alert.mp3` (short bell).  
      * If `Notification.permission === "granted"`, show browser push notification.  
      * Update state to reâ€‘render alert zone.  
    - On first mount, request notification permission (if not already denied).

**Testing**  
- Mock pending requests and verify countdown timer.  
- Toggle online/offline â€“ API should be called.  
- Ensure sidebar navigation works on both desktop and mobile.

---

## ğŸ“¦ Promptâ€¯10 â€“ Booking Request Screen (Pending State)

**Goal**  
Build the detailed booking request page for pending requests, with earnings breakdown (dual scenario), samagri indicator, food allowance, travel preview, and accept/reject with 6â€‘hour timer.

**Files to create/modify**  
- `apps/pandit/app/bookings/[id]/page.tsx`  
- `apps/pandit/components/EarningsBreakdown.tsx` â€“ shows both scenarios sideâ€‘byâ€‘side  
- `apps/pandit/components/SamagriIndicator.tsx` â€“ badge for package vs platform list  
- `apps/pandit/components/FoodAllowanceDetail.tsx` â€“ perâ€‘day breakdown

**Detailed instructions**

1. **Fetch booking data**  
   - Use `GET /api/pandit/bookings/{id}` to get full booking details.  
   - Identify if status is `PANDIT_REQUESTED`, `CONFIRMED`, etc. This screen will render differently based on status.

2. **Voice narration** â€“ play the Hindi summary from sectionâ€¯K2.

3. **Event summary card**  
   - Booking ID (amber badge), status badge, event type, muhurat date/time, city, customer name (first + initial), customer rating, attendees, special instructions.

4. **Samagri choice indicator** (critical)  
   - Show one of two badges with clear icon and text:  
     * If customer chose Pandit package: amber badge â€œğŸ“¦ Pandit Ji ka Package: Standard â€” â‚¹5,500â€ and note â€œà¤†à¤ª à¤‡à¤¸ package à¤•à¥€ full price à¤•à¤®à¤¾à¤à¤‚à¤—à¥‡à¥¤â€  
     * If platform custom list: blue badge â€œğŸ›’ Platform Custom Listâ€ and note â€œCustomer à¤…à¤ªà¤¨à¥€ samagri à¤–à¥à¤¦ manage à¤•à¤°à¥‡à¤—à¤¾à¥¤ à¤†à¤ªà¤•à¥€ samagri earning: â‚¹0â€

5. **Food allowance details**  
   - If travel required: show table with travel days and puja days breakdown, each â‚¹1,000/day.  
   - If customer provides meals on puja days, show only travel days.

6. **Earnings breakdown (dual scenario)**  
   - Render two columns (or stacked on mobile):  
     * Scenario A (Pandit Package): highlighted with amber border.  
     * Scenario B (Platform List): grayed out.  
   - Each column shows: Dakshina, Platform Fee, Net Dakshina, Samagri Earnings, Travel Reimbursement, Food Allowance, Total Earning.  
   - Note: â€œTravel amount final à¤¹à¥‹à¤—à¤¾ à¤œà¤¬ admin travel book à¤•à¤°à¥‡à¤—à¤¾à¥¤â€

7. **Travel itinerary preview**  
   - For outstation bookings: show fromâ€‘to, selected travel mode, note that platform will arrange, accommodation arrangement.

8. **6â€‘hour timer + Accept/Reject buttons**  
   - Live countdown (same as on dashboard card).  
   - Accept button: opens confirmation modal â€œà¤•à¥à¤¯à¤¾ à¤†à¤ª à¤¯à¤¹ booking accept à¤•à¤°à¤¨à¤¾ à¤šà¤¾à¤¹à¤¤à¥‡ à¤¹à¥ˆà¤‚?â€ â†’ on confirm, call `PATCH /api/pandit/bookings/{id}/accept`. On success, show toast and redirect to the same page (now in active state).  
   - Reject button: opens reason dropdown (options from spec) and confirm â†’ call `PATCH /api/pandit/bookings/{id}/decline { reason }`. On success, redirect to dashboard with toast.

**Testing**  
- Mock a pending booking with both samagri types and verify the correct badge and earnings scenario are shown.  
- Let the timer expire; the page should show â€œExpiredâ€ and not allow accept/reject.

---

## ğŸ“¦ Promptâ€¯11 â€“ Active Booking & Itinerary

**Goal**  
For confirmed/active bookings, display dayâ€‘byâ€‘day itinerary, â€œI'm Hereâ€ sequential buttons, customer phone reveal rules, and document wallet.

**Files to create/modify**  
- `apps/pandit/app/bookings/[id]/page.tsx` (extend to handle active states)  
- `apps/pandit/components/ItineraryTimeline.tsx` â€“ vertical day cards  
- `apps/pandit/components/StatusButtons.tsx` â€“ sequential buttons with completion tracking  
- `apps/pandit/components/DocumentWallet.tsx` â€“ list of downloadable documents

**Detailed instructions**

1. **State detection**  
   - If booking status is `CONFIRMED` or higher, render the active view instead of the pending view.

2. **Dayâ€‘byâ€‘day itinerary**  
   - Build from `booking.travelItinerary` (if stored) or generate based on event dates and travel mode.  
   - Each day card shows:  
     * Day label (e.g., â€œDay 1 â€” 14 March (Travel Day)â€) with amber background.  
     * Activities (depart, arrive, puja) with times.  
     * Food allowance per day (green text): â€œFood Allowance: â‚¹1,000â€ (if applicable).  
   - Total food allowance summary at bottom.

3. **â€œI'm Hereâ€ sequential buttons**  
   - Stepper with up to 6 buttons (as per spec):  
     * ğŸšŒ à¤¯à¤¾à¤¤à¥à¤°à¤¾ à¤¶à¥à¤°à¥‚ à¤•à¤°à¥‡à¤‚  
     * ğŸ¨ à¤¹à¥‹à¤Ÿà¤² à¤ªà¤¹à¥à¤‚à¤šà¤¾  
     * ğŸ“ Venue à¤ªà¤¹à¥à¤‚à¤šà¤¾  
     * ğŸ”¥ à¤ªà¥‚à¤œà¤¾ à¤¶à¥à¤°à¥‚  
     * ğŸ™ à¤ªà¥‚à¤œà¤¾ à¤¸à¤‚à¤ªà¤¨à¥à¤¨  
     * ğŸ”™ à¤µà¤¾à¤ªà¤¸à¥€ (only for outstation)  
   - Each button is active only when the previous step is completed.  
   - On click, call corresponding API endpoint (`/start-journey`, `/arrived`, etc.).  
   - After successful API call, button becomes disabled/green checkmark, next button enabled.  
   - The â€œVenue à¤ªà¤¹à¥à¤‚à¤šà¤¾â€ step reveals full customer phone number (update UI accordingly).

4. **Customer phone reveal rules**  
   - Store phone visibility in state. Initially hidden (masked).  
   - After `PANDIT_ARRIVED` status, show full phone as clickable `tel:` and WhatsApp link.

5. **Digital wallet / documents section**  
   - Title â€œğŸ“ à¤¦à¤¸à¥à¤¤à¤¾à¤µà¥‡à¤œà¤¼ à¤”à¤° à¤Ÿà¤¿à¤•à¤Ÿâ€.  
   - List of documents (train/flight tickets, hotel confirmation, cab booking, food allowance receipt, booking summary).  
   - Each item: document name, [à¤¦à¥‡à¤–à¥‡à¤‚] (opens in new tab) and [à¤¡à¤¾à¤‰à¤¨à¤²à¥‹à¤¡] (forces download).  
   - Documents are served from URLs stored in `Booking.travelDocuments` (admin uploads them).

**Testing**  
- Step through the status buttons in order; ensure each triggers the correct API and updates UI.  
- Check that phone is masked until arrival.  
- Test document download.

---

## ğŸ“¦ Promptâ€¯12 â€“ Calendar Management

**Goal**  
Build a custom calendar grid where pandit can see bookings and block/unblock dates.

**Files to create/modify**  
- `apps/pandit/app/calendar/page.tsx`  
- `apps/pandit/components/CalendarGrid.tsx` â€“ custom grid (no library)  
- `apps/pandit/components/DayDetailPanel.tsx` â€“ slideâ€‘in/up panel  
- `apps/pandit/components/BlockDateModal.tsx` â€“ modal to add block

**Detailed instructions**

1. **Layout**  
   - Twoâ€‘column on desktop: calendar (left), upcoming events list (right).  
   - Single column on mobile (events below calendar).  
   - Top controls: month navigation arrows, [à¤†à¤œ] button, [+ à¤›à¥à¤Ÿà¥à¤Ÿà¥€ à¤œà¥‹à¤¡à¤¼à¥‡à¤‚] button.

2. **Calendar grid**  
   - Build a 7â€‘column table with day headers in Hindi (à¤°, à¤¸à¥‹, à¤®à¤‚, à¤¬à¥, à¤—à¥, à¤¶à¥, à¤¶).  
   - Each cell at least 80â€¯px tall (desktop) / 56â€¯px (mobile).  
   - Fetch data via `GET /api/pandit/calendar?month=YYYY-MM`.  
   - Color coding:  
     * White: available (no booking, no block)  
     * Amber fill (`#FDE9C3`): has booking  
     * Red fill (`#FEE2E2`): blocked by pandit  
     * Gray fill: past date  
     * Dark amber border: today  
   - Cell content: day number, small amber badge with event time + truncated type if booking, â€œğŸ”´ à¤›à¥à¤Ÿà¥à¤Ÿà¥€â€ if blocked.

3. **Day detail panel**  
   - When a cell is clicked, slide in panel (right on desktop, bottom on mobile).  
   - Shows date, list of bookings (if any) with links to `/bookings/{id}`, or blocked info with [Unblock] button.  
   - If available, [+ à¤‡à¤¸ à¤¦à¤¿à¤¨ à¤›à¥à¤Ÿà¥à¤Ÿà¥€ à¤œà¥‹à¤¡à¤¼à¥‡à¤‚] button â†’ opens BlockDateModal.

4. **BlockDateModal**  
   - Fields: start date (preâ€‘filled), end date (optional), reason (optional).  
   - On submit, call `POST /api/pandit/blackout-dates`.  
   - Before creating, check for conflicting confirmed bookings in the range. If any, show conflict dialog with list and â€œà¤¹à¤¾à¤, à¤«à¤¿à¤° à¤­à¥€ block à¤•à¤°à¥‡à¤‚â€ / â€œà¤µà¤¾à¤ªà¤¸ à¤œà¤¾à¤à¤‚â€.  
   - If confirmed, create block and refresh calendar.

5. **Unblock**  
   - From day detail panel, click â€œUnblockâ€ â†’ `DELETE /api/pandit/blackout-dates/{id}`.

**Testing**  
- Verify that days with bookings appear amber.  
- Block a date, see it turn red.  
- Try blocking a range that includes an existing booking â€“ conflict dialog should appear.

---

## ğŸ“¦ Promptâ€¯13 â€“ Earnings View

**Goal**  
Implement earnings summary with monthly chart, perâ€‘booking breakdown, and payout status.

**Files to create/modify**  
- `apps/pandit/app/earnings/page.tsx`  
- `apps/pandit/components/BarChart.tsx` â€“ simple SVG bar chart  
- `apps/pandit/components/EarningsList.tsx` â€“ expandable perâ€‘booking rows

**Detailed instructions**

1. **Monthly summary header**  
   - Period selector dropdown (last 12 months).  
   - Three stat boxes:  
     * â€œà¤•à¥à¤² à¤•à¤®à¤¾à¤ˆâ€ â€“ large amber number, subtitle with booking count.  
     * â€œà¤­à¥à¤—à¤¤à¤¾à¤¨ à¤¹à¥‹ à¤—à¤¯à¤¾â€ â€“ green, with bank lastâ€‘four.  
     * â€œà¤¬à¤¾à¤•à¥€ à¤¹à¥ˆâ€ â€“ orange, with pending booking count.  
   - Bank account card: â€œà¤­à¥à¤—à¤¤à¤¾à¤¨ à¤œà¤¾à¤à¤—à¤¾: SBI â€¢â€¢â€¢â€¢4521 â€” à¤¬à¤šà¤¤ à¤–à¤¾à¤¤à¤¾â€ with [à¤¬à¤¦à¤²à¥‡à¤‚] link to profile.

2. **Bar chart**  
   - Last 6 months of monthly totals.  
   - Xâ€‘axis: month name (short Hindi), Yâ€‘axis: â‚¹ amounts.  
   - Bars: amber, hover shows exact amount.  
   - No chart library â€“ build with pure CSS/SVG.

3. **Perâ€‘booking list**  
   - Expandable list of bookings in the selected month.  
   - Each collapsed row shows: date, event type, city, customer first name, gross amount, payout status badge.  
   - Expanded view shows full breakdown: dakshina, platform fee, net dakshina, samagri earnings, travel reimbursement, food allowance, total payout (green).  
   - Payout status: PAID (green), PENDING (amber), PROCESSING (blue).

4. **Data fetching**  
   - `GET /api/pandit/earnings/summary?month=YYYY-MM` returns the structure from sectionâ€¯N6.  
   - Update when month changes.

**Testing**  
- Check that chart renders correctly.  
- Expand a booking row to see detailed math.

---

## ğŸ“¦ Promptâ€¯14 â€“ Profile Management

**Goal**  
Build the profile page with tabs for editing all information, samagri packages, and device info.

**Files to create/modify**  
- `apps/pandit/app/profile/page.tsx` â€“ tabs container  
- `apps/pandit/app/profile/tabs/PersonalTab.tsx`  
- `apps/pandit/app/profile/tabs/PujaServicesTab.tsx`  
- `apps/pandit/app/profile/tabs/TravelTab.tsx`  
- `apps/pandit/app/profile/tabs/SamagriTab.tsx` (reâ€‘use Stepâ€¯4 components)  
- `apps/pandit/app/profile/tabs/BankDocumentsTab.tsx`  
- `apps/pandit/components/DeviceInfoDisplay.tsx` â€“ readâ€‘only device card

**Detailed instructions**

1. **Tabs** (using `<Tabs>` from shared UI)  
   - Labels: à¤µà¥à¤¯à¤•à¥à¤¤à¤¿à¤—à¤¤ à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€, à¤ªà¥‚à¤œà¤¾ à¤¸à¥‡à¤µà¤¾à¤à¤‚, à¤¯à¤¾à¤¤à¥à¤°à¤¾ à¤ªà¥à¤°à¤¾à¤¥à¤®à¤¿à¤•à¤¤à¤¾à¤à¤‚, à¤¸à¤¾à¤®à¤—à¥à¤°à¥€ Packages, à¤¬à¥ˆà¤‚à¤• & Documents.

2. **Personal tab**  
   - Editable fields from Stepâ€¯1 (except Aadhaar/PAN â€“ show masked, maybe require reâ€‘verification to edit).  
   - Profile photo and audio bio can be reâ€‘uploaded.  
   - Device information card (readâ€‘only) with [Device Update à¤•à¤°à¥‡à¤‚] button that reâ€‘triggers device info capture and PATCH.

3. **Puja services tab**  
   - List of existing puja services, each can be edited (dakshina, duration, description).  
   - Ability to add new puja types (using same grid as Stepâ€¯2).  
   - Save changes via `PATCH /api/pandit/puja-services`.

4. **Travel tab**  
   - Same fields as Stepâ€¯3, preâ€‘filled with current preferences.  
   - Save via `PATCH /api/pandit/travel-preferences`.

5. **Samagri tab**  
   - Reâ€‘use Stepâ€¯4 components, but allow editing/deleting/adding packages.  
   - Each package can be enabled/disabled, items edited, price changed.  
   - Delete package with confirmation.  
   - Save via `PATCH /api/pandit/samagri-packages/{id}` and `DELETE /api/pandit/samagri-packages/{id}`.

6. **Bank & Documents tab**  
   - View current verification status (badge).  
   - Bank details (masked) with edit option (requires reâ€‘submission for verification).  
   - Upload additional documents (if needed).  
   - Show list of previously uploaded documents.

7. **API endpoints**  
   - `GET /api/pandit/profile` â€“ returns full profile.  
   - `PATCH /api/pandit/profile` â€“ partial updates.  
   - `PATCH /api/pandit/puja-services/{id}` etc.

**Testing**  
- Edit a field, save, refresh â€“ change should persist.  
- Update device info â€“ should reflect new values.

---

## ğŸ“¦ Promptâ€¯15 â€“ Backend API Implementation

**Goal**  
Implement all backend endpoints referenced in previous prompts. This is a consolidated prompt covering the necessary routes.

**Files to create/modify** (in `services/api/src/`)  
- `routes/pandit.routes.ts` â€“ all panditâ€‘specific routes  
- `controllers/pandit.controller.ts` â€“ handlers  
- `services/pandit.service.ts` â€“ business logic  
- `middleware/auth.ts` â€“ ensure pandit role  
- `utils/encryption.ts` â€“ for Aadhaar number encryption  
- `utils/bookingNumber.ts` â€“ generator  
- `utils/pricing.ts` â€“ platform fee, GST, food allowance calculations

**Detailed instructions**

Implement all endpoints listed in sectionâ€¯P. Use the following guidelines:

- All routes under `/api/pandit` require `authenticateToken` and `requireRole('PANDIT')`.  
- File upload endpoints (profile photo, audio bio, KYC docs) should store files locally (in `public/uploads/` or cloud storage) and return the URL.  
- Aadhaar number must be encrypted before storing (use AESâ€‘256 with a secret from env).  
- On booking accept, status transition should trigger SMS via `notification.service` (mock).  
- On booking completion, create a `Payout` record with status `PENDING`.  
- For calendar, fetch bookings where status NOT IN [CANCELLED, REFUNDED] and date in month.  
- For blackout dates, check conflicts with confirmed bookings before creation.  
- Earnings summary: aggregate from completed bookings in the given month.

**Testing**  
- Use Postman to hit each endpoint with mock JWT.  
- Verify file uploads work.

---

## ğŸ“¦ Promptâ€¯16 â€“ Final Integration & Launch Checklist

**Goal**  
Integrate all pieces, run through the Phaseâ€¯1 checklist, and prepare for launch.

**Instructions**

1. **Run the full flow**  
   - Start the API server (`localhost:3001`) and the pandit PWA (`localhost:3002`).  
   - Go through onboarding as a new pandit, ensuring every step works and data persists.  
   - After onboarding, check dashboard loads with pending banner.  
   - Simulate a new booking (via admin) and verify the alert appears, timer works, accept/reject works.  
   - Go through â€œI'm Hereâ€ buttons, verify status updates.  
   - Check calendar, block a date, verify it appears.  
   - View earnings.

2. **Check all nonâ€‘negotiable items** from sectionâ€¯Q1.  
   - Use a printed checklist and mark each feature as done.  
   - Pay special attention to the âš¡ items: audio bio, device info capture, 6â€‘hour timer, samagri indicator, food allowance breakdown, voice buttons everywhere.

3. **Fix any missing pieces**  
   - Ensure all voice buttons are present.  
   - Ensure all error messages are in Hindi.  
   - Test on a real lowâ€‘end Android device (or emulate) to verify touch targets and performance.

4. **Deferred features** (sectionâ€¯Q2)  
   - Document them in a `PHASE2.md` file.  
   - Do not implement them now.

5. **Launch**  
   - Build the app: `npm run build` (should succeed).  
   - Deploy to a staging environment first, then to production.

---

**End of Prompts**

These 16 prompts, executed in order, will build the complete HmarePanditJi Pandit PWA exactly as specified in Bhagâ€¯12. No detail has been omitted. Follow them carefully and test each step. ğŸ™